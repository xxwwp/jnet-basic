<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.0.2"/><title data-react-helmet="true"></title><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-tomorrow.css"/><link as="script" rel="preload" href="/jnet-basic-v2/webpack-runtime-a52939d631f5cc604aea.js"/><link as="script" rel="preload" href="/jnet-basic-v2/framework-e8e53ba50a7a1b0850f7.js"/><link as="script" rel="preload" href="/jnet-basic-v2/app-38218a2ef72326a75367.js"/><link as="script" rel="preload" href="/jnet-basic-v2/1512ff2dbf77859a0dcbee24710e2018e282937f-369ee37846485c1e14f7.js"/><link as="script" rel="preload" href="/jnet-basic-v2/component---src-templates-docs-tsx-3f6722c11400634ddec5.js"/><link as="fetch" rel="preload" href="/jnet-basic-v2/page-data/js/渲染与加载/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/jnet-basic-v2/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css-global b48ifx">body{margin:0;}html,body{overflow-x:hidden;}</style><style data-emotion="css-global 1vo6k5w">body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";color:#303133;}</style><style data-emotion="css zdq125">.css-zdq125{position:fixed;left:0;top:0;bottom:0;-webkit-transition:-webkit-transform 0.3s,opacity 0.3s;transition:transform 0.3s,opacity 0.3s;overflow:hidden;z-index:10;}@media screen and (min-width: 1200px){.css-zdq125:hover{overflow:auto;overflow:overlay;}}@media screen and (max-width: 1200px){.css-zdq125{opacity:0;-webkit-transform:translateX(-100%);-moz-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);}.css-zdq125.active{opacity:1;-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);overflow:auto;overflow:overlay;}.css-zdq125 nav{width:100vw;}}</style><aside class=" css-zdq125"><style data-emotion="css k4cgyt">.css-k4cgyt{width:200px;overflow:hidden;padding:10px 0px 50px;border-right:4px double rgba(0, 0, 0, 0.1);min-height:100%;background:#fff;}.css-k4cgyt .title{text-align:center;}.css-k4cgyt .title a{line-height:40px;color:#c0c0c0;-webkit-text-decoration:none;text-decoration:none;font-size:1.5em;}</style><nav class="css-k4cgyt"><div class="title"><a href="/jnet-basic-v2/">JNet Basic</a></div><style data-emotion="css smzts4">.css-smzts4 ol{list-style:none;padding-left:20px;margin:0;}.css-smzts4 ol ol{padding-left:10px;}.css-smzts4 ol li{line-height:30px;margin:0;}.css-smzts4 ol a{color:#555;-webkit-text-decoration:none;text-decoration:none;line-height:30px;}.css-smzts4 ol a:hover,.css-smzts4 ol a.current{color:#999;}</style><div class="css-smzts4"><ol><li><style data-emotion="css opu5s9">.css-opu5s9.active{color:#999;}</style><a class="css-opu5s9" href="/jnet-basic-v2/课程介绍">课程介绍</a></li><li><span>html</span><ol><li><a class="css-opu5s9" href="/jnet-basic-v2/html/概述">概述</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/基础理论">基础理论</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/头部学习">头部学习</a></li><li><span>元素学习</span><ol><li><a class="css-opu5s9" href="/jnet-basic-v2/html/元素学习/文章相关的元素">文章相关的元素</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/元素学习/超链接与图片">超链接与图片</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/元素学习/无语义元素">无语义元素</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/元素学习/表格">表格</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/元素学习/表单元素">表单元素</a></li></ol></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/属性">属性</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/html/补充与结束">补充与结束</a></li></ol></li><li><span>css</span><ol><li><a class="css-opu5s9" href="/jnet-basic-v2/css/概述">概述</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/选择器">选择器</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/核心概念-层叠，继承，优先级">核心概念-层叠，继承，优先级</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/盒模型与文档流">盒模型与文档流</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/文本处理">文本处理</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/表格处理">表格处理</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/背景处理">背景处理</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/杂项">杂项</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/基础布局">基础布局</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/布局进阶">布局进阶</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/常见布局练习">常见布局练习</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/css/补充与结束">补充与结束</a></li></ol></li><li><span>js</span><ol><li><a class="css-opu5s9" href="/jnet-basic-v2/js/程序引导课">程序引导课</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/基础">基础</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/数据、运算符和表达式">数据、运算符和表达式</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/函数和作用域">函数和作用域</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/引用类型">引用类型</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/流程控制">流程控制</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/类型判断与类型转换">类型判断与类型转换</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/函数深入">函数深入</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/常用_API">常用_API</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/异步编程">异步编程</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/提升">提升</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/闭包">闭包</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/this_关键字">this_关键字</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/对象原型">对象原型</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/面向对象">面向对象</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/DOM">DOM</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/事件">事件</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/BOM">BOM</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载">渲染与加载</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/错误处理">错误处理</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/严格模式">严格模式</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/正则字符串">正则字符串</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/网络简述">网络简述</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/杂项">杂项</a></li></ol></li><li><a class="css-opu5s9" href="/jnet-basic-v2/总练习">总练习</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/课程总结">课程总结</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/素材">素材</a></li></ol></div></nav></aside><style data-emotion="css 1308utl">.css-1308utl{position:fixed;right:1rem;bottom:1rem;z-index:100;background-color:rgba(82, 122, 253, 0.37);border-radius:50%;padding:10px;border:none;width:20px;height:20px;box-sizing:content-box;-webkit-transition:background-color 0.3s;transition:background-color 0.3s;}@media screen and (min-width: 1200px){.css-1308utl{display:none;}}.css-1308utl svg{width:inherit;height:inherit;-webkit-transition:-webkit-transform 0.3s;transition:transform 0.3s;-webkit-transform:rotateX(0);-moz-transform:rotateX(0);-ms-transform:rotateX(0);transform:rotateX(0);}.css-1308utl.active{background-color:rgba(0, 0, 0, 0.123);}.css-1308utl.active svg{-webkit-transform:rotateX(180deg);-moz-transform:rotateX(180deg);-ms-transform:rotateX(180deg);transform:rotateX(180deg);}</style><button class=" css-1308utl"><svg enable-background="new 0 0 32 32" id="Слой_1" version="1.1" viewBox="0 0 32 32"><path d="M24.285,11.284L16,19.571l-8.285-8.288c-0.395-0.395-1.034-0.395-1.429,0  c-0.394,0.395-0.394,1.035,0,1.43l8.999,9.002l0,0l0,0c0.394,0.395,1.034,0.395,1.428,0l8.999-9.002  c0.394-0.395,0.394-1.036,0-1.431C25.319,10.889,24.679,10.889,24.285,11.284z" fill="#121313" id="Expand_More"></path><g></g><g></g><g></g><g></g><g></g><g></g></svg></button><style data-emotion="css 117dd4v">.css-117dd4v{margin:auto;width:90%;max-width:760px;}.css-117dd4v .article-container{padding:50px 10px;}.css-117dd4v .article-catalog{position:fixed;top:0;left:80%;left:calc(50% + 380px);bottom:0;overflow:hidden;z-index:10;}.css-117dd4v .article-catalog:hover{overflow:auto;overflow:overlay;padding-right:1rem;}@media screen and (max-width: 1200px){.css-117dd4v .article-catalog{display:none;}}</style><main class="css-117dd4v"><aside class="article-catalog"><style data-emotion="css f4f9ae">.css-f4f9ae{padding:20px 0;white-space:nowrap;min-width:120px;box-sizing:content-box;}.css-f4f9ae .title{padding-left:20px;margin-bottom:20px;font-size:1.2em;font-weight:lighter;}</style><nav class="css-f4f9ae"><div class="title">目录</div><style data-emotion="css smzts4">.css-smzts4 ol{list-style:none;padding-left:20px;margin:0;}.css-smzts4 ol ol{padding-left:10px;}.css-smzts4 ol li{line-height:30px;margin:0;}.css-smzts4 ol a{color:#555;-webkit-text-decoration:none;text-decoration:none;line-height:30px;}.css-smzts4 ol a:hover,.css-smzts4 ol a.current{color:#999;}</style><div class="css-smzts4"><ol><li><style data-emotion="css opu5s9">.css-opu5s9.active{color:#999;}</style><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载/#载入与解析">载入与解析</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载/#浏览器内核">浏览器内核</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载/#JavaScript 载入">JavaScript 载入</a></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载/#样式计算、绘制与排列">样式计算、绘制与排列</a><ol><li><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载/#主动重排">主动重排</a></li></ol></li><li><a class="css-opu5s9" href="/jnet-basic-v2/js/渲染与加载/#eval 加载 JavaScript">eval 加载 JavaScript</a></li></ol></div></nav></aside><div class="article-container"><style data-emotion="css dsvq8h">.css-dsvq8h{line-height:1.5;}.css-dsvq8h h1,.css-dsvq8h h2,.css-dsvq8h h3,.css-dsvq8h h4,.css-dsvq8h h5,.css-dsvq8h h6{font-weight:500;line-height:1.2;color:#212529;}.css-dsvq8h h1 a,.css-dsvq8h h2 a,.css-dsvq8h h3 a,.css-dsvq8h h4 a,.css-dsvq8h h5 a,.css-dsvq8h h6 a,.css-dsvq8h h1 a:hover,.css-dsvq8h h2 a:hover,.css-dsvq8h h3 a:hover,.css-dsvq8h h4 a:hover,.css-dsvq8h h5 a:hover,.css-dsvq8h h6 a:hover,.css-dsvq8h h1 a:active,.css-dsvq8h h2 a:active,.css-dsvq8h h3 a:active,.css-dsvq8h h4 a:active,.css-dsvq8h h5 a:active,.css-dsvq8h h6 a:active,.css-dsvq8h h1 a:visited,.css-dsvq8h h2 a:visited,.css-dsvq8h h3 a:visited,.css-dsvq8h h4 a:visited,.css-dsvq8h h5 a:visited,.css-dsvq8h h6 a:visited{color:inherit;}.css-dsvq8h h1{font-size:2.5rem;}.css-dsvq8h h2{font-size:2rem;}.css-dsvq8h h3{font-size:1.75rem;}.css-dsvq8h h4{font-size:1.5rem;}.css-dsvq8h h5{font-size:1.25rem;}.css-dsvq8h h6{font-size:1rem;}.css-dsvq8h p{font-weight:400;font-size:1rem;}.css-dsvq8h em{background-color:#fcf8e3;font-style:normal;color:#000;}.css-dsvq8h blockquote{margin:1.25rem -1rem;padding:0.5rem 1.25rem;border:1px solid #eee;border-left-width:0.25rem;border-radius:0.25rem;border-left-color:#f0ad4e;}.css-dsvq8h blockquote cite{text-align:right;color:silver;font-size:1rem;}.css-dsvq8h ul,.css-dsvq8h ol{padding-left:2rem;}.css-dsvq8h .remark-highlight{margin-left:-1rem;margin-right:-1rem;}.css-dsvq8h pre{border-radius:5px;box-shadow:0 0 10px 3px #cacaca;}.css-dsvq8h code{color:#e83e8c;font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:87.5%;}.css-dsvq8h img{box-shadow:0 0 10px 3px rgba(222, 226, 230, 0.548);border-radius:5px;}.css-dsvq8h a{color:#0d6efd;}.css-dsvq8h a:hover{color:#488df5;}.css-dsvq8h a:visited{color:#0a5dda;}.css-dsvq8h a:active{color:#72a6f5;text-shadow:0 0 3px #7e8af8;}</style><article class="css-dsvq8h"><h1>渲染与加载</h1><hr/><style data-emotion="css 1u87juy">.css-1u87juy:hover svg{visibility:visible;}</style><h2 id="载入与解析" class="css-1u87juy">载入与解析<style data-emotion="css 17vkerv">.css-17vkerv{float:left;margin-left:-24px;color:inherit;}.css-17vkerv svg{visibility:hidden;}</style><a href="#载入与解析" class="css-17vkerv"><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" color="inherit"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2><p>在我们访问一个 HTML 文件的时候，浏览器对 HTML 文件的解析分为以下几步：</p><ol><li><p>获取 HTML 代码。通过一个 URL 来获取 HTML 代码，这个代码可能是本地的，也可能是网络的。HTML 代码会被浏览器从上到下解析。</p></li><li><p>解析的开始，浏览器会为 HTML 代码生成一个 DOM，最初这个 DOM 并不是完整的，通过对 HTML 一步一步的解析，DOM 的内容逐步被填充。比如在 <code>head</code> 元素内打印 <code>document.body</code>，会得到 <code>null</code>，就是因为 <code>body</code> 元素当时还没有被解析。</p></li><li><p>如果解析过程中，遇到外部资源，比如外部 CSS、外部 JavaScript、图片、视频等，那么会立即拉取这些资源：</p><ul><li><p>如果遇到的是 CSS 代码，会对 CSS 进行解析。根据 CSS 的选择器对各个 CSS 的声明块分类，DOM 会匹配这些 CSS 的样式生成一个可以用来渲染的渲染树。页面会根据渲染树的规则，进行绘制。一般情况下，渲染树是等页面解析结束后，一次性渲染，不会解析到一个元素，就渲染一个元素。特殊情况下，渲染树会提前渲染。</p></li><li><p>如果遇到的是 JavaScript 代码，内部代码会直接执行，外部代码就立刻拉取代码，不同的浏览器引擎，JavaScript 可能会不同程度的干扰到渲染树的绘制。</p><p>编写以下代码嵌入到 HTML 中间：</p><div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>在火狐中，JavaScript 代码并不会阻塞浏览器对 HTML 代码的解析，JavaScript 会执行，但不会触发渲染树对页面进行绘制。</li><li>在 IE 中，渲染树的绘制会因 JavaScript 运行完全阻塞，直到 JavaScript 运行结束。</li><li>在 Chrome 中， 渲染树会先绘制当前渲染树中的内容，再去执行 JavaScript 代码，JavaScript 代码的运行会阻塞页面的解析。</li></ul></li><li><p>如果遇到的是其他外部资源，比如图片、视频等，它们会立即被拉取，并且在拉取完成后触发对应的加载结束事件。它们的拉取过程并不会阻塞页面向下解析。</p></li></ul></li><li><p>当 HTML 解析结束，DOM 构建完毕，浏览器会触发 DOM 的 <code>DOMContentLoaded</code> 事件，此时并不代表页面已经正常渲染，因为渲染树的绘制可能还没有结束，图片视频等资源也不一定都加载完成，但是 <code>document</code> 对象已经可以正常访问了。</p></li><li><p>当页面上所有资源的拉取都结束后，会触发 BOM 的 <code>load</code> 事件，代表页面加载完毕。</p></li></ol><p>非常遗憾的是，并没有提供浏览器绘制页面结束的事件。</p><h2 id="浏览器内核" class="css-1u87juy">浏览器内核<a href="#浏览器内核" class="css-17vkerv"><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" color="inherit"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2><p>各个浏览器的底层并不一样，浏览器的底层引擎常常被称为 <strong>内核</strong>。因为内核的不同，所以在加载资源与绘制页面时，所发生的情况并不一致，比如前一节中，不同浏览器对待 JavaScript 运行和页面绘制的处理方式并不完全相同。目前主流的内核如下：</p><style data-emotion="css l3k28e">.css-l3k28e{overflow-x:auto;margin:1rem -1rem;box-shadow:0 0 10px 3px rgba(222, 226, 230, 0.548);border-radius:5px;}.css-l3k28e table{border-collapse:collapse;min-width:100%;}.css-l3k28e thead tr{border-bottom:1px solid currentColor;}.css-l3k28e tbody tr{border-bottom:1px solid #dee2e6;}.css-l3k28e tbody tr:hover{background-color:#f8f9fa;}.css-l3k28e td,.css-l3k28e th{padding:0.75em;border:inherit;text-align:left;}.css-l3k28e th{white-space:nowrap;}</style><div class="css-l3k28e"><table><thead><tr><th>内核</th><th>浏览器</th><th>描述</th></tr></thead><tbody><tr><td>Trident</td><td>IE</td><td>微软自研内核，不是开源的，专为 windows 设计，但是优化非常差，比如上一段代码，一亿次空循环，在其他内核很快，但是在 Trident 内核中就会严重卡顿。它的兼容性也非常的差，在 CSS 渲染、DOM&amp;BOM 上构建混乱，前端开发大部分兼容性问题都来自 Trident 内核。</td></tr><tr><td>Gecko</td><td>FireFox 火狐</td><td>火狐自研开源内核，功能强大，跨拼台能力强，横跨 windows、linux、安卓或者 mac 系统。不论是对用户还是前端开发者，都非常友好。</td></tr><tr><td>webkit</td><td>Safari &amp; 旧版 Chrome</td><td>苹果公司自研开源内核，同样具有优秀的功能，很多国产浏览器也是使用这个内核。</td></tr><tr><td>Blink</td><td>Chrome &amp; 新版 Edge</td><td>谷歌公司基于 webkit 修改的内核，历经更改，它已经成为了一个独立的内核。</td></tr></tbody></table></div><h2 id="JavaScript 载入" class="css-1u87juy">JavaScript 载入<a href="#JavaScript 载入" class="css-17vkerv"><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" color="inherit"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2><p>为了更好的演示本节的知识点，可以使用以下代码：</p><div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zh-CN<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">body</span> <span class="token punctuation">{</span>
        <span class="token property">column-count</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">p</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token color">black</span><span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">h1</span> <span class="token punctuation">{</span>
        <span class="token property">column-span</span><span class="token punctuation">:</span> all<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>荷塘月色<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>作者: 朱自清<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      这几天心里颇不宁静。今晚在院子里坐着乘凉，忽然想起日日走过的荷塘，在这满月的光里，总该另有一番样子吧。月亮渐渐地升高了，墙外马路上孩子们的欢笑，已经听不见了；妻在屋里拍着闰儿，迷迷糊糊地哼着眠歌。我悄悄地披了大衫，带上门出去。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      沿着荷塘，是一条曲折的小煤屑路。这是一条幽僻的路；白天也少人走，夜晚更加寂寞。荷塘四面，长着许多树，蓊蓊郁郁的。路的一旁，是些杨柳，和一些不知道名字的树。没有月光的晚上，这路上阴森森的，有些怕人。今晚却很好，虽然月光也还是淡淡的。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      路上只我一个人，背着手踱着。这一片天地好像是我的；我也像超出了平常的自己，到了另一世界里。我爱热闹，也爱冷静；爱群居，也爱独处。像今晚上，一个人在这苍茫的月下，什么都可以想，什么都可以不想，便觉是个自由的人。白天里一定要做的事，一定要说的话，现在都可不理。这是独处的妙处，我且受用这无边的荷香月色好了。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      曲曲折折的荷塘上面，弥望的是田田的叶子。叶子出水很高，像亭亭的舞女的裙。层层的叶子中间，零星地点缀着些白花，有袅娜地开着的，有羞涩地打着朵儿的；正如一粒粒的明珠，又如碧天里的星星，又如刚出浴的美人。微风过处，送来缕缕清香，仿佛远处高楼上渺茫的歌声似的。这时候叶子与花也有一丝的颤动，像闪电般，霎时传过荷塘的那边去了。叶子本是肩并肩密密地挨着，这便宛然有了一道凝碧的波痕。叶子底下是脉脉的流水，遮住了，不能见一些颜色；而叶子却更见风致了。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      　　月光如流水一般，静静地泻在这一片叶子和花上。薄薄的青雾浮起在荷塘里。叶子和花仿佛在牛乳中洗过一样；又像笼着轻纱的梦。虽然是满月，天上却有一层淡淡的云，所以不能朗照；但我以为这恰是到了好处——酣眠固不可少，小睡也别有风味的。月光是隔了树照过来的，高处丛生的灌木，落下参差的斑驳的黑影，峭楞楞如鬼一般；弯弯的杨柳的稀疏的倩影，却又像是画在荷叶上。塘中的月色并不均匀；但光与影有着和谐的旋律，如梵婀玲上奏着的名曲。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      　　荷塘的四面，远远近近，高高低低都是树，而杨柳最多。这些树将一片荷塘重重围住；只在小路一旁，漏着几段空隙，像是特为月光留下的。树色一例是阴阴的，乍看像一团烟雾；但杨柳的丰姿，便在烟雾里也辨得出。树梢上隐隐约约的是一带远山，只有些大意罢了。树缝里也漏着一两点路灯光，没精打采的，是渴睡人的眼。这时候最热闹的，要数树上的蝉声与水里的蛙声；但热闹是它们的，我什么也没有。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      　　忽然想起采莲的事情来了。采莲是江南的旧俗，似乎很早就有，而六朝时为盛；从诗歌里可以约略知道。采莲的是少年的女子，她们是荡着小船，唱着艳歌去的。采莲人不用说很多，还有看采莲的人。那是一个热闹的季节，也是一个风流的季节。梁元帝《采莲赋》里说得好：
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      　　于是妖童媛女，荡舟心许；鷁首徐回，兼传羽杯；欋将移而藻挂，船欲动而萍开。尔其纤腰束素，迁延顾步；夏始春余，叶嫩花初，恐沾裳而浅笑，畏倾船而敛裾。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>　　可见当时嬉游的光景了。这真是有趣的事，可惜我们现在早已无福消受了。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>　　于是又记起《西洲曲》里的句子：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
      　　采莲南塘秋，莲花过人头；低头弄莲子，莲子清如水。今晚若有采莲人，这儿的莲花也算得“过人头”了；只不见一些流水的影子，是不行的。这令我到底惦着江南了。——这样想着，猛一抬头，不觉已是自己的门前；轻轻地推门进去，什么声息也没有，妻已睡熟好久了。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>多列布局可以更好的演示各个浏览器的差异。</p><p>目前为止，我们编写的 JavaScript 都是同步加载的，这些同步加载的 JS 代码被称作 <strong>同步脚本</strong>，同步脚本按从上到下的顺序执行。因此，如果不在 HTML 末尾执行 JavaScript，并不能获取到完整的 DOM 树，所以一直到现在，我们演示的大部分代码，都是在 HTML 文件的末尾。</p><p>如果太早执行 JS 代码，将无法获取完整的 DOM，比如把脚本放到 <code>head</code> 元素中，在脚本汇总获取 <code>document.body</code>，就会得到 <code>null</code>，这是因为当时 DOM 还没有解析完成。</p><p><code>DOMContentLoaded</code> 事件可以监听 DOM 加载完毕，在 DOM 加载完成后事件会被触发。通过 <code>DOMContentLoaded</code> 事件可以让代码在 DOM 构建结束后再执行代码。</p><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里可以正常选取到所有 p 元素，不论这段 JavaScript 代码放到页面中的任何地方。</span>
  <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果使用外部引入 JavaScript 代码，那么可以通过下面两个属性设置 JavaScript 的运行和解析方式。</p><div class="css-l3k28e"><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td><code>async</code></td><td>布尔属性，设置一个异步脚本。JavaScript 代码被异步拉取，不干扰 HTML 的解析，当 JS 代码全部拉取完毕后，会尽可能早的执行。它可能是会在任何一个时间段执行，不一定等到 HTML 解析完毕。</td></tr><tr><td><code>defer</code></td><td>布尔属性，设置一个延迟脚本。让代码在 DOM 构建完毕，DOM 事件 <code>DOMContentLoaded</code> 之前运行。</td></tr></tbody></table></div><p>新建三个 JS 文件，<code>default.js</code>、<code>async.js</code>、<code>defer.js</code> 内容如下：</p><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// default.js</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;default.js&quot;</span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContendLoaded&quot;</span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// async.js</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;async.js&quot;</span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// defer.js</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;defer.js&quot;</span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过外部引入，把它们放到 <code>head</code> 元素中，如下：</p><div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./async.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./defer.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./default.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在浏览器中连续刷新，它们不是每次执行的顺序都完全一致，如果异步脚本拉取执行得早，可能会和默认脚本一样，在 DOM 构建完毕之前执行。同步脚本会在运行的时候直接执行，延时脚本会紧跟其后，<code>DOMContentLoaded</code> 事件最后执行。</p><p>如果异步脚本执行的晚，可能获得一个解析到一半的 DOM，如果更晚，那么可以获取到一个完整的 DOM，不同的内核对此的处理并不一致。而延迟的脚本 <code>defer.js</code> 总是会等到 DOM 构建完毕后，才执行，所以总是能获取到完整的 DOM。然而在其他内核中可能又会出现不同的情况，比如火狐的 Gecko，它会不会在 HTML 解析过程结束前执行异步脚本，快得话就立马执行，慢的话就不执行。</p><p>可以给 HTML 添加几千上万行代码，来验证上述观点（vscode 中，你可以使用 <code>p{填充文本}*1000</code> + 【tab】键创建 1000 个 <code>p</code> 元素）。如果添加几千个 <code>p</code> 元素并填充一定量的内容，那么 HTML 文件会非常大，异步脚本使用 <code>document.getElementsByTagName(&#x27;p&#x27;)</code> 可能无法获取到全部 <code>p</code> 元素，或者获取到一部分 <code>p</code> 元素。而延迟脚本就总是获取到全部 <code>p</code> 元素，并且在 <code>DOMContentLoaded</code> 事件前执行。</p><p>异步脚本和延迟脚本有什么用？</p><p>首先，它们都不会阻塞页面渲染，在本页【载入与解析】一节中，同步脚本使用 <code>for</code> 执行上亿次循环时，因为 JavaScript 的执行，某些浏览器会阻塞页面渲染，但是异步脚本和延迟脚本不会阻塞页面。因为它们都不会干扰当前页面的解析。合理的运用的话，页面初次绘制会非常迅速并不产生阻塞。</p><p>需要注意的是，在异步脚本或者延迟脚本中不要注册 <code>DOMContentLoaded</code> 事件。如果异步脚本在 <code>DOMContentLoaded</code> 事件后执行，那么代码就会作废，因为此事件只会执行一次。如果在延迟脚本中使用 <code>DOMContentLoaded</code> 事件也是多此一举，因为延迟脚本在 DOM 构建完毕后，<code>DOMContentLoaded</code> 事件前执行，注册这个事件并没有多大意义。</p><h2 id="样式计算、绘制与排列" class="css-1u87juy">样式计算、绘制与排列<a href="#样式计算、绘制与排列" class="css-17vkerv"><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" color="inherit"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2><p>引擎会根据渲染树的规则，对元素进行 <strong>绘制</strong> 与 <strong>排列</strong>。每次渲染树的改变，都会重新进行 <strong>样式计算</strong>，从而得到一个新的渲染树，浏览器会按照新的渲染树进行 <strong>重绘</strong> 或 <strong>重排</strong>。</p><p>样式计算、绘制与排列都会对消耗性能，如果代码在这方面的优化太差，网页在使用时就很容易出现卡顿的现象，比较明显的就是页面出来了，滚动鼠标页面一卡一卡的，出现这种情况的原因就可能是因为渲染树的改变，页面一直在进行样式计算、重绘或者重排。</p><p>改变渲染树中布局之外的样式修改发生重绘，比如，字体颜色，边框颜色，透明度等等，浏览器会被重新绘制这部分样式。</p><p>渲染树中的布局改变会发生重排，比如一个普通元素修改成了浮动，或者修改了 <code>margin</code> 让其位置改变，或者一行文本被添加了几个字，内容产生了换行等等，这些情况浏览器会重新排列并绘制页面，所以重排是包含重绘的。</p><p>得力于现代浏览器内核的优化，通常来说，浏览器并不会因为一个小操作，立即对页面进行重绘或者重排，比如：</p><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> ul <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这里把 ul 添加到 DOM 中，渲染树被修改，但是并不会立即重排页面</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>ul<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  li<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> <span class="token string">&quot;第 &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot; 项&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">// 这里同理，每个 li 元素被插入到 ul 中，渲染树被修改，但是不会立即重排</span>
  ul<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 这里在改变了样式，渲染树被修改，但不会立刻进行样式计算</span>
  li<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token operator">=</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取元素在渲染树中的真实样式，getComputedStyle 属性会产生样式计算</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 程序结束 页面开始根据新的渲染树重排重绘页面</span>
</code></pre></div><p>关于页面的性能，可以在浏览器控制台的 Performance 模块看到，如果页面打开很卡顿，那么就可以到此模块下分析原因。</p><p>【Performance 使用演示】</p><p>如果一个元素没有被加入到 DOM 中，是无法通过渲染树计算其样式的。所以上面代码中，如果把 <code>documen.body.appendChild(ul)</code> 放到末尾，代码可以照样运行，但 <code>getComputedStyle</code> 无法获取到 <code>li</code> 元素的样式。虽然这样做无法实时获取 <code>li</code> 的样式，但也有好处，因为改变 <code>li.style.color</code> 的值时，渲染树并不会立即重新计算样式，它会等到最后 <code>ul</code> 被加入到 DOM 后，一次性计算所有样式，可以减少计算产生的开销。</p><p>重排和重绘发生在任何页面改变的情况下，比如页面滚动，窗口大小变化等等。</p><h3 id="主动重排" class="css-1u87juy">主动重排<a href="#主动重排" class="css-17vkerv"><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" color="inherit"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3><p>我们可以主动触发浏览器重排，在此之前先介绍一个额外的 CSS3 属性 <code>transition</code>。</p><p><code>transition</code> 属性可以让元素的样式改变，有一个平滑的过渡，而不是直接改变，比如：</p><div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector"><span class="token id">#foo</span></span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token id">#foo</span><span class="token pseudo-class">:hover</span></span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode color">#000</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面样式 HTML 代码中，当我们把鼠标放到 <code>#foo</code> 元素上后，其背景色和宽度发送了变化，这种变化并没有过渡，是直接触发的，尝试给 <code>#foo</code> 选择器添加以下属性：</p><div class="remark-highlight"><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token id">#foo</span></span> <span class="token punctuation">{</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> background-color <span class="token number">2</span><span class="token unit">s</span><span class="token punctuation">,</span> width <span class="token number">1</span><span class="token unit">s</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>transition: background-color 2s, width 1s;</code> 这行声明会让 <code>#foo</code> 元素的背景色和宽度改变时，分别在 2 秒的时间内从开始状态过渡到最终状态。现在把鼠标放到 <code>#foo</code> 元素上，你会发现元素的背景和宽度改变时会平滑的过渡。如果使用 JS 改变 <code>#foo</code> 元素的背景色和宽度，过渡依然奏效，过渡不是一次性的，添加以下代码：</p><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundColor</span> <span class="token operator">=</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  foo<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>#foo</code> 元素会不断改变背景色和宽度，每次改变都会产生过渡效果。</p><p>这和重排重绘有什么关系？</p><p>思考下面代码，页面会发生什么：</p><div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector"><span class="token id">#foo</span></span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">black</span><span class="token punctuation">;</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> background-color <span class="token number">2</span><span class="token unit">s</span><span class="token punctuation">,</span> width <span class="token number">1</span><span class="token unit">s</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  foo<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  foo<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundColor</span> <span class="token operator">=</span> <span class="token string">&quot;#000&quot;</span><span class="token punctuation">;</span>
  foo<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">=</span> <span class="token string">&quot;800px&quot;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面的代码我们创建了一个 <code>div</code> 元素 <code>id</code> 为 <code>foo</code>，记作 <code>#foo</code>。我们设置了 <code>#foo</code> 元素的样式，让它的背景色和宽度发生变化时平滑过渡。</p><p>我们希望的想法是 <code>#foo</code> 元素在插入 DOM 后有一个平滑过渡的状态，因为我们改变了它的背景色和宽度，但是过渡并没有发生。</p><p>这是因为当我们把元素插入到 DOM 中时，会产生样式计算，但是页面不会立刻重绘重排，<code>#foo</code> 元素还没有渲染。接着我们改变了它的背景色和宽度，又产生了样式计算。当程序运行结束后，浏览器会根据计算后的新渲染树进行绘制，此时背景色和宽度已经被设置为最终状态了，所以过渡无法完成。</p><p>为了解决这个问题，我们需要在元素插入到 DOM 后，让浏览器立即重绘或者重排，保留一个过渡的初始状态。浏览器并没有内置触发重排和重绘的方法，但是访问一些属性的时候，浏览器会立即重排，会触发重排的属性如下：</p><p>窗口偏移：</p><ul><li><code>window.pageXOffset</code>：获取 X 轴的滚动偏移量</li><li><code>window.pageYOffset</code>：获取 X 轴的滚动偏移量</li><li><code>document.body.scrollLeft</code>： IE7 以下获取 X 轴的滚动偏移量</li><li><code>document.body.scrollTop</code>：IE7 以下获取 Y 轴的滚动偏移量</li><li><code>document.documentElement.scrollLeft</code>：IE9 以下获取 X 轴的滚动偏移量</li><li><code>document.documentElement.scrollTop</code>：IE9 以下获取 Y 轴的滚动偏移量</li></ul><p>显示大小：</p><ul><li><code>Element.clientHeight</code>：元素的 <code>padding + content - 滚动条</code> 的高度。</li><li><code>Element.clientWidth</code>：元素的 <code>padding + content - 滚动条</code> 的宽度。</li><li><code>Element.offsetHeight</code>：元素的 <code>border + padding + content</code> 的高度。</li><li><code>Element.offsetWidth</code>：元素的 <code>border + padding + content</code> 的宽度。</li></ul><p>相对位置：</p><ul><li><code>Element.offsetParent</code>：获取元素的参考父级</li><li><code>Element.offsetTop</code>：相对 offsetParent 的顶部内边距距离</li><li><code>Element.offsetLeft</code>：相对 offsetParent 的左侧内边距距离</li></ul><p>绝对位置：</p><ul><li><code>Element.getBoundingClientRect</code></li></ul><p>滚动位置：</p><ul><li><code>Element.scrollHeight</code>：滚动区高度。</li><li><code>Element.scrollWidth</code>：滚动区宽度。</li><li><code>Element.scrollTop</code>：已滚动高度，可设置。</li><li><code>Element.scrollLeft</code>：已滚动宽度，可设置。</li></ul><p>这是之前在 DOM 大小与位置中介绍的属性，你肯定觉得非常难记忆，那么你可以反向记忆，获取页面或元素大小与位置的所有属性中，只有以下四个不会发生重排：</p><ul><li><code>window.innerHeight</code>：窗口高度。</li><li><code>window.innerWidth</code>：窗口宽度。</li><li><code>getComputedStyle()</code>：获取计算样式，此方法会产生样式计算。</li></ul><h2 id="eval 加载 JavaScript" class="css-1u87juy">eval 加载 JavaScript<a href="#eval 加载 JavaScript" class="css-17vkerv"><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" color="inherit"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2><p>极少数情况下，JavaScript 代码会以字符串的形式出现，可以使用内置函数 <code>eval</code> 把一段字符串当做 JavaScript 代码执行，比如：</p><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> jscode <span class="token operator">=</span> <span class="token string">&quot;var foo = 1; console.log(foo)&quot;</span><span class="token punctuation">;</span>
<span class="token function">eval</span><span class="token punctuation">(</span>jsCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>使用 <code>eval</code> 这种加载 JS 代码的方式是明令禁止的，因为它非常不安全。</p></blockquote><p>如果代码本身就由前端开发人员编写，<code>eval</code> 完全不需要，所以一般这使用 <code>eval</code> 运行的代码都是开发者之外人员编写的代码，这部分代码可能存在一定的安全问题，比如盗取数据，或者干扰当前代码。</p><p><code>eval</code> 中的代码并不是独立运行的，它会使用当前作用域，比如：</p><div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> jsCode <span class="token operator">=</span> <span class="token string">&quot;var bar = 2; console.log(foo)&quot;</span><span class="token punctuation">;</span>
<span class="token function">eval</span><span class="token punctuation">(</span>jsCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上述代码中，<code>eval</code> 执行的 JS 代码可以使用外部的变量 <code>foo</code>，其内部定义的变量 <code>bar</code> 也可以在外部定义，所以非常不安全。</p></article></div></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/js/渲染与加载/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-da8157b780a7e1fd9e9e.js"],"app":["/app-38218a2ef72326a75367.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f91e86cfe65092e3adc1.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-57b3b630e72243cc3df9.js"],"component---src-templates-docs-tsx":["/component---src-templates-docs-tsx-3f6722c11400634ddec5.js"]};/*]]>*/</script><script src="/jnet-basic-v2/polyfill-da8157b780a7e1fd9e9e.js" nomodule=""></script><script src="/jnet-basic-v2/component---src-templates-docs-tsx-3f6722c11400634ddec5.js" async=""></script><script src="/jnet-basic-v2/1512ff2dbf77859a0dcbee24710e2018e282937f-369ee37846485c1e14f7.js" async=""></script><script src="/jnet-basic-v2/app-38218a2ef72326a75367.js" async=""></script><script src="/jnet-basic-v2/framework-e8e53ba50a7a1b0850f7.js" async=""></script><script src="/jnet-basic-v2/webpack-runtime-a52939d631f5cc604aea.js" async=""></script></body></html>